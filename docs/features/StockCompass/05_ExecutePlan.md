# ã‚¿ã‚¹ã‚¯å‡¦ç†ã€ãƒ¡ãƒ¼ãƒ«
## ç›®çš„
Cronãªã©ã§ä½œæˆã•ã‚ŒãŸã‚­ãƒƒã‚¯ã‚’ã‚‚ã¨ã«
åˆ†æé–‹å§‹ã€åˆ†æã—ãŸçµæœã‚’
ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸæƒ…å ±ã¨ã—ã¦ã€ãƒ¡ãƒ¼ãƒ«ã§åˆ©ç”¨è€…ã«é€šçŸ¥

## å‰æ
ã‚ã‚‰ã‹ã˜ã‚ãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¦ãŠã
ãƒ—ãƒ©ãƒ³ã«å¾“ã£ã¦ã€Entryã‚µã‚¤ãƒ³ã®æ¤œç´¢ã€Exitã‚µã‚¤ãƒ³ã®æ¤œç´¢ã‚’è¡Œã£ãŸçµæœã‚’ã‚¢ãƒŠã‚¦ãƒ³ã‚¹
Entryã‚µã‚¤ãƒ³ã‹ã‚‰ã€Webç”»é¢ã«é·ç§»ã—ã¦ã€ãã“ã‹ã‚‰ã€è³¼å…¥æƒ…å ±ã®å…¥æ¤ãŸå¯èƒ½
è³¼å…¥æ‰±ã„ã®æƒ…å ±æ–¹ã¯ã€Exitã‚µã‚¤ãƒ³æ¢çŸ¥ã®å¯¾è±¡ã¨ãªã‚‹ã€‚

## å‹•ã
è»¢é€ã™ã‚‹ã«ã¯ï¼‘æ—¥ï¼‘å›ã‚’æƒ³å®š
æƒ³å®šæ™‚ã«ã¯æœ¬æ—¥ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚µã‚¤ãƒ³å–å¾—éŠ˜æŸ„
è³¼å…¥æ¸ˆã¿ã®ã‚¨ã‚°ã‚¸ãƒƒãƒˆã‚µã‚¤ãƒ³ã®çŠ¶æ³

### äº‹å‰æº–å‚™

- palnã®ä½œæˆï¼ˆæ—¢å­˜æ©Ÿèƒ½ï¼‰
  - å¯¾è±¡ã®éŠ˜æŸ„ã®æŒ‡å®šï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ï¼šsptch_analysis_conditions sptch_stock_selections_header sptch_stock_selections_stocksï¼‰
  - éŠ˜æŸ„ã«å¯¾ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼æŒ‡å®šï¼ˆä¸Šé™é‡‘é¡ãªã©ï¼‰ï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ï¼šsptch_analysis_conditions sptch_trade_parametersï¼‰
  - Entryã‚µã‚¤ãƒ³ã®ç™»éŒ²ï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ï¼šsptch_analysis_conditions sptch_signals sptch_entry_signalsï¼‰
  - Exitã‚µã‚¤ãƒ³ã®ç™»éŒ²ï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ï¼šsptch_analysis_conditions sptch_signals sptch_exit_signalsï¼‰
  - ç¨ãƒ»æ‰‹æ•°æ–™ã®ç™»éŒ²ï¼ˆåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ï¼šsptch_analysis_conditions sptch_fee_taxesï¼‰
- ãƒ—ãƒ©ãƒ³ã«å¯¾ã—ã¦ã®å®šæœŸçš„ã«å®Ÿè¡Œã™ã‚‹ãŸã‚ã®è¨­å®šã€€ãƒ†ãƒ¼ãƒ–ãƒ«åï¼šPlanExecutionSettings:sptce_plan_execution_settings
  - ãƒ—ãƒ©ãƒ³è‡ªä½“ã¯åˆ¥ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚‚ã¤ã€‚ã‚ãã¾ã§ã‚‚å®šæœŸçš„ã«å®Ÿè¡Œã™ã‚‹ãŸã‚ã®è¨­å®š
  - æœŸé–“ï¼ˆ2025/08/01ã‹ã‚‰2025/08/10ã¾ã§ãªã©ï¼‰
    - æŒ‡å®šã•ã‚ŒãŸæœŸé–“ã§ã®èª¿æŸ»ã‚’è¡Œã†ã€‚ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¾ã§ã®å‡¦ç†ã‚’å®Ÿæ–½
  - è‡ªå‹•ã§ã®ï¼¥ï½ï½”ï½’ï½™ï¼Œï¼¥ï½˜ï½‰ï½”ã®å®Ÿæ–½ãƒ•ãƒ©ã‚°
    - å®Ÿæ–½ãƒ•ãƒ©ã‚°ãŒãŸã£ã¦ã„ã‚‹å ´åˆã«ã¯è‡ªå‹•ã§å£²è²·ã—ãŸã¨ã—ã¦ã®ã‚·ãƒ¥ãƒŸãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿæ–½
    - è³¼å…¥ã—ãŸã€å£²å´ã—ãŸã¨ã—ã¦è¨˜éŒ²ã‚’æ®‹ã™
    - è¨˜éŒ²ã‚’æ®‹ã•ãªã„å ´åˆã¯ã€æ‰‹å‹•ã§ã®è³¼å…¥ã®å®Ÿæ–½ã€å£²å´ã®å®Ÿæ–½ã‚’è¡Œã†ã€ãã®æ™‚ã®éŠ˜æŸ„ãªã©ã¯å€‹åˆ¥ã§ç™»éŒ²ã™ã‚‹ã€‚
  - é€ä¿¡å…ˆãƒ¡ã‚¢ãƒ‰ç¢ºèª
- ãƒ—ãƒ©ãƒ³ã«å¯¾ã—ã¦è‡ªå‹•ã§ä½œæˆã—ãŸå ´åˆã®æ ªå–å¼•ã®æƒ…å ± ãƒ†ãƒ¼ãƒ–ãƒ«åï¼šPlanExecutionSimulationResults:sptce_plan_execution_simulation_results
  - å®Ÿéš›ã«å£²è²·ã—ãŸã°ã‚ã¯åˆ¥ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†ã™ã‚‹

- sptce_xxx sptc + c + e (c:cron e:execute)ã€€è­˜åˆ¥å­

### ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¾ã§
![CCronSendMail](images/CronSendmail_image01.drawio.png)


- Resendã®åˆ©ç”¨
  - ï¼‘æ—¥200ä»¶ã»ã©
  - Sendmailã¯ä¼æ¥­ã§ã®å¥‘ç´„ãŒå¿…è¦ãªã®ã§ã€åˆ©ç”¨ä¸å¯ã®èªè­˜

### ãƒ¡ãƒ¼ãƒ«å—ä¿¡å¾Œã®å‡¦ç†

![ReciveMail](images/CronSendmail_image02.drawio.png)


### ğŸ“§ãƒ¡ãƒ¼ãƒ«æ–‡ä¾‹

---

ä»¶åï¼š
ã€StockProfit10ã€‘æœ¬æ—¥ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ»ã‚¨ã‚°ã‚¸ãƒƒãƒˆæƒ…å ±ï¼ˆ2025å¹´12æœˆ12æ—¥ é‡‘æ›œæ—¥åˆ†ï¼‰

æœ¬æ–‡ï¼š

---

ã€‡ã€‡æ§˜
StockProfit10ã‚ˆã‚Šæœ¬æ—¥ï¼ˆ2025å¹´12æœˆ12æ—¥ï¼‰ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°çµæœã‚’ãŠé€ã‚Šã—ã¾ã™ã€‚
ä»¥ä¸‹ãƒªãƒ³ã‚¯ã‚ˆã‚Šè©³ç´°ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

---

ğŸ”” **æœ¬æ—¥ã®é€šçŸ¥æ¦‚è¦**

* æœ¬æ—¥ã®**ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚µã‚¤ãƒ³æ¤œå‡ºéŠ˜æŸ„**ï¼šã‚ã‚Š / ãªã—
* **è³¼å…¥æ¸ˆéŠ˜æŸ„**ã®**ã‚¨ã‚°ã‚¸ãƒƒãƒˆã‚µã‚¤ãƒ³çŠ¶æ³**ï¼šã‚ã‚Š / ãªã—

**é€šçŸ¥è©³ç´°**
[æœ¬æ—¥ã®é€šçŸ¥è©³ç´°ã¯ã“ã¡ã‚‰](https://ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»)

**é€šçŸ¥å±¥æ­´ä¸€è¦§**
[é€šçŸ¥ä¸€è¦§ã¯ã“ã¡ã‚‰](https://ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»)

**ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ­ã‚°**
[ãƒ­ã‚°ã¯ã“ã¡ã‚‰](https://ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»)

**ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸**
[StockProfit10 ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸](https://ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»)

---

**è£œè¶³**

* æœ¬é€šçŸ¥ã¯äº‹å‰ã«è¨­å®šã•ã‚ŒãŸãƒ—ãƒ©ãƒ³ã«åŸºã¥ãã€è‡ªå‹•çš„ã«ä½œæˆãƒ»é€ä¿¡ã•ã‚Œã¦ã„ã¾ã™ã€‚
* æ¤œå‡ºã•ã‚ŒãŸã‚¨ãƒ³ãƒˆãƒªãƒ¼éŠ˜æŸ„ã¯Webç”»é¢ã‹ã‚‰ã€Œãƒ‡ãƒ¢è³¼å…¥ã€ãŒå¯èƒ½ã§ã™ã€‚
* ãƒ‡ãƒ¢è³¼å…¥ã•ã‚ŒãŸéŠ˜æŸ„ã¯ã€å¾Œæ—¥ã‚¨ã‚°ã‚¸ãƒƒãƒˆã‚µã‚¤ãƒ³æ¤œå‡ºå¾Œã«ã€Œãƒ‡ãƒ¢å£²å´ã€å¯èƒ½ã§ã™ã€‚
* æç›ŠçŠ¶æ³ç­‰ã¯ä¸€è¦§ç”»é¢ã‚ˆã‚Šã”ç¢ºèªã„ãŸã ã‘ã¾ã™ã€‚

âš ï¸ å®Ÿéš›ã®æ ªå¼è³¼å…¥ãƒ»å£²å´ã¯ã”åˆ©ç”¨ã®è¨¼åˆ¸ä¼šç¤¾ã«ã¦è¡Œã£ã¦ãã ã•ã„ã€‚

---

ğŸ“© **ã“ã®ãƒ¡ãƒ¼ãƒ«ã«å¿ƒå½“ãŸã‚ŠãŒãªã„å ´åˆ**
è¨­å®šç”»é¢ã«ã¦å‡¦ç†å¯¾è±¡ã‚„é€ä¿¡å¯¾è±¡ã‹ã‚‰é™¤å¤–è¨­å®šã§ãã¾ã™ã€‚
[è¨­å®šå¤‰æ›´ã¯ã“ã¡ã‚‰](https://ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»)

---

StockProfit10
è‡ªå‹•é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 



## ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³
- 
### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«
  * **`sptch_analysis_conditions`**: æ ªã®åˆ†æãƒ—ãƒ©ãƒ³ã‚’å®šç¾©ã™ã‚‹ä¸»è¦ãªãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚
    * **`sptch_simulation_results_stocks`**: `sptch_analysis_conditions` ã«åŸºã¥ãéŠ˜æŸ„ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®çµæœã‚’æ ¼ç´ã—ã¾ã™ã€‚ã©ã®éŠ˜æŸ„ãŒæŠ•è³‡å¯¾è±¡ã«ãªã£ãŸã‹ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚
    * **`sptch_simulation_results_trade`**: `sptch_analysis_conditions` ã«åŸºã¥ãå€‹ã€…ã®éŠ˜æŸ„ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‹ã‚‰ã‚¨ã‚°ã‚¸ãƒƒãƒˆã¾ã§ï¼‰ã‚’æ ¼ç´ã—ã¾ã™ã€‚
    * **`sptch_simulation_results_summary`**: `sptch_analysis_conditions` ã«åŸºã¥ããƒ—ãƒ©ãƒ³å…¨ä½“ã®ç·åˆçš„ãªæç›Šçµæœã‚’æ ¼ç´ã—ã¾ã™ã€‚
    * **`sptch_simulation_results`**: ç‰¹å®šã®åˆ†æãƒ—ãƒ©ãƒ³ (`sptch_analysis_conditions`) ã«å¯¾ã™ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œå…¨ä½“ã®çŠ¶æ³ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€é–‹å§‹/å®Œäº†æ™‚åˆ»ã€æ¦‚è¦ã€ã‚¨ãƒ©ãƒ¼ãªã©ï¼‰ã‚’ç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚
    * **`sptch_simulation_logs`**: `sptch_simulation_results` ã®å„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã«ãŠã‘ã‚‹å€‹åˆ¥ã®å‡¦ç†ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°ãªãƒ­ã‚°ï¼ˆé–‹å§‹/å®Œäº†æ™‚åˆ»ã€å‡¦ç†æ™‚é–“ã€è©³ç´°æƒ…å ±ãªã©ï¼‰ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚



### âœ… `sptce_plan_execution_settings`ï¼ˆãƒ—ãƒ©ãƒ³å®šæœŸå®Ÿè¡Œè¨­å®šï¼‰

| ã‚«ãƒ©ãƒ å                  | ãƒ‡ãƒ¼ã‚¿å‹            | èª¬æ˜                                             |
| --------------------- | --------------- | ---------------------------------------------- |
| `id`                  | `int` (PK)      | ä¸»ã‚­ãƒ¼                                            |
| `analysis_condition_id` | `int` (FK)      | å¯¾è±¡ã®åˆ†æãƒ—ãƒ©ãƒ³ï¼ˆ`sptch_analysis_conditions.Id`ï¼‰ã¸ã®å¤–éƒ¨ã‚­ãƒ¼ |
| `name`                | `text`       | åå‰ï¼ˆå ±å‘Šã«ã¯è¨˜è¼‰ã™ã‚‹ã€å®Ÿè¡Œã‚¿ã‚¹ã‚¯åï¼‰ |
| `start_date`           | `date`          | å®Ÿè¡ŒæœŸé–“ã®é–‹å§‹æ—¥ï¼ˆã“ã®æ—¥ä»˜ã‹ã‚‰å®Ÿè¡Œã€å®Ÿéš›ã«ã¯å‰æ—¥ã®æƒ…å ±ã‹ã‚‰ã®å‡¦ç†ï¼‰   |
| `end_date`             | `date`          | å®Ÿè¡ŒæœŸé–“ã®çµ‚äº†æ—¥ ï¼ˆã“ã®æ—¥ã¾ã§ã®å®Ÿè¡Œã€ã‚ãã¾ã§ã‚‚åˆ†æå¯¾è±¡ã®æ—¥ä»˜ãªã®ã§ã€å®Ÿéš›ã®å‡¦ç†ã¯å…ˆã«ãªã‚‹å¯èƒ½æ€§ã‚ã‚Šï¼‰  |
| `excute_end_date`             | `date`          | exit-signã«å¾“ã£ã¦ã€æœ€å¤§ã§ã®æ—¥ä»˜ã€æ—¢ã«éŠ˜æŸ„æ‰€æœ‰ã—ã¦ã„ãªã„ã‚‚ã®ã¯è©•ä¾¡å¯¾è±¡å¤– |
| `is_auto_enabled`  | `bit`           | è‡ªå‹•ã‚¨ãƒ³ãƒˆãƒªãƒ¼å®Ÿæ–½ãƒ•ãƒ©ã‚°                                   |
| `is_active`            | `bit`           | ã“ã®è¨­å®šãŒæœ‰åŠ¹ã‹ã©ã†ã‹ï¼ˆå®šæœŸãƒãƒƒãƒãŒæ‹¾ã†å¯¾è±¡ã‹ï¼‰                       |
| `send_mail_to`          | `nvarchar(255)` | çµæœé€ä¿¡å…ˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°æŒ‡å®šå¯ï¼‰                    |
| `created_at`           | `datetime`      | ä½œæˆæ—¥æ™‚                                           |
| `updated_at`           | `datetime`      | æ›´æ–°æ—¥æ™‚                                           |

> ğŸ” **å‚™è€ƒ**:
>
> * ã€Œé€ä¿¡å…ˆãƒ¡ã‚¢ãƒ‰ç¢ºèªã€ã¯ `send_mail_to` ã§å¯¾å¿œ
> * æ—¢å­˜ãƒ—ãƒ©ãƒ³ã¨ã®é–¢é€£æ€§ã‚’ä¿ã¤ãŸã‚ `analysis_condition_id` ã‚’æŒ‡å®š


### âœ… `sptce_plan_execution_simulation_results`ï¼ˆå®šæœŸå®Ÿè¡Œã«ã‚ˆã‚‹å£²è²·ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœï¼‰
| ã‚«ãƒ©ãƒ å                   | ãƒ‡ãƒ¼ã‚¿å‹            | èª¬æ˜                                   |
| ---------------------- | --------------- | ------------------------------------ |
| `id`                   | `int` (PK)      | ä¸»ã‚­ãƒ¼                                  |
| `execution_setting_id` | `int` (FK)      | å®Ÿè¡Œè¨­å®šã¸ã®å¤–éƒ¨ã‚­ãƒ¼ï¼ˆPlanExecutionSettings.Idï¼‰ |
| `stock_code`           | `varchar(12)`   | éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰                                |
| `entry_sign_date`      | `date`          | Entryã‚·ã‚°ãƒŠãƒ«ãŒå‡ºãŸæ—¥                        |
| `entry_auto_flg`       | `boolean`       | Entryã‚’è‡ªå‹•å®Ÿè¡Œã—ãŸã‹                        |
| `entry_date`           | `date`          | Entryå®Ÿè¡Œæ—¥ï¼ˆæƒ³å®šï¼‰                         |
| `entry_price`          | `decimal(18,2)` | Entryä¾¡æ ¼                              |
| `entry_quantity`       | `int`           | Entryæ ªæ•°                              |
| `exit_sign_date`       | `date`          | Exitã‚·ã‚°ãƒŠãƒ«ãŒå‡ºãŸæ—¥                         |
| `exit_auto_flg`        | `boolean`       | Exitã‚’è‡ªå‹•å®Ÿè¡Œã—ãŸã‹                         |
| `exit_date`            | `date`          | Exitå®Ÿè¡Œæ—¥ï¼ˆæƒ³å®šï¼‰                          |
| `exit_price`           | `decimal(18,2)` | Exitä¾¡æ ¼                               |
| `exit_quantity`        | `int`           | Exitæ ªæ•°                               |
| `commission_fee`       | `decimal(18,2)` | æ‰‹æ•°æ–™                                  |
| `tax`                  | `decimal(18,2)` | ç¨é‡‘                                   |
| `cost`                 | `decimal(18,2)` | ã‚³ã‚¹ãƒˆåˆè¨ˆï¼ˆæ‰‹æ•°æ–™+ç¨ï¼‰                         |
| `note`                 | `text` | è‡ªç”±è¨˜è¼‰                         |
| `created_at`           | `datetime`      | ä½œæˆæ—¥æ™‚                                 |
| `updated_at`           | `datetime`      | æ›´æ–°æ—¥æ™‚                                 |



> ğŸ” **å‚™è€ƒ**:
>
> * **å®Ÿéš›ã®ãƒˆãƒ¬ãƒ¼ãƒ‰çµæœã¨ã¯åˆ†é›¢**ï¼ˆæœ¬ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å°‚ç”¨ï¼‰
> * 1è¡Œã«entry exit ã¨ã‚‚ã«è¨˜éŒ²
> ï¼‘ã¤ã®ã‚·ãƒ¥ãƒŸãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‘è¡Œã§æ‰±ã†ã‚‚ã®ã¨ã™ã‚‹ã€‚
> Entrã‹ã‚‰Exitã¾ã§ã‚’ã‚‚ã¤ã€å„ã€…ã®ã‚µã‚¤ãƒ³ç™ºç”Ÿæ—¥ã€å®Ÿéš›ã®å£²è²·ã—ãŸæ—¥ä»˜ã‚’ã‚‚ã¤ã€ExitDateãŒå…¥ã£ã¦ã„ã‚‹ã‚‚ã®ã¯æ—¢ã«å‡¦åˆ†æ¸ˆã¿ã¨æ‰±ã†


---

### ğŸ”— é–¢é€£æ§‹é€ ï¼ˆæ¦‚è¦å›³ï¼‰

```plaintext
sptch_analysis_conditions (ãƒ—ãƒ©ãƒ³æœ¬ä½“)
    â†‘
    â””â”€ sptce_plan_execution_settings
           â†‘
           â””â”€ sptce_plan_execution_simulation_results
```


ä»¥ä¸‹ã¯ **Supabase (PostgreSQL)** ã«å¯¾å¿œã—ãŸ `sptce_plan_execution_settings` ãŠã‚ˆã³ `sptce_plan_execution_simulation_results` ãƒ†ãƒ¼ãƒ–ãƒ«ã®DDLï¼ˆ`CREATE TABLE`ï¼‰ã§ã™ã€‚

---

### âœ… `sptce_plan_execution_settings` `sptce_plan_execution_simulation_results` ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

```sql
CREATE TABLE sptce_plan_execution_settings (
    id SERIAL PRIMARY KEY,
    analysis_condition_id INTEGER NOT NULL REFERENCES sptch_analysis_conditions(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    excute_end_date DATE,
    is_auto_enabled BOOLEAN NOT NULL DEFAULT FALSE,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    send_mail_to TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
CREATE TABLE sptce_plan_execution_simulation_results (
    id SERIAL PRIMARY KEY,
    execution_setting_id INTEGER NOT NULL REFERENCES sptce_plan_execution_settings(id) ON DELETE CASCADE,
    stock_code VARCHAR(12) NOT NULL,
    entry_sign_date DATE,
    entry_auto_flg BOOLEAN DEFAULT FALSE,
    entry_date DATE,
    entry_price DECIMAL(18,2),
    entry_quantity INTEGER,
    exit_sign_date DATE,
    exit_auto_flg BOOLEAN DEFAULT FALSE,
    exit_date DATE,
    exit_price DECIMAL(18,2),
    exit_quantity INTEGER,
    commission_fee DECIMAL(18,2),
    tax DECIMAL(18,2),
    cost DECIMAL(18,2),
    note TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);


ALTER TABLE public.sptce_plan_execution_settings DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.sptce_plan_execution_simulation_results DISABLE ROW LEVEL SECURITY;

-- ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL PRIVILEGES ON SEQUENCES TO authenticated;
-- ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL PRIVILEGES ON SEQUENCES TO anon;

-- æ—¢å­˜ã®ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¯¾ã—ã¦æ¨©é™ã‚’ä»˜ä¸
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO anon;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO authenticated;

-- ä»Šå¾Œ public ã‚¹ã‚­ãƒ¼ãƒã§ä½œæˆã•ã‚Œã‚‹ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¯¾ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ¨©é™ã‚’ä»˜ä¸
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT USAGE, SELECT ON SEQUENCES TO anon;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT USAGE, SELECT ON SEQUENCES TO authenticated;

-- ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆé€šå¸¸ã¯ postgresï¼‰ãŒä½œæˆã™ã‚‹å°†æ¥ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¯¾ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™ã‚’è¨­å®š
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT, INSERT, UPDATE, DELETE ON TABLES TO authenticated;
-- å°†æ¥ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«å¯¾ã™ã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™ã‚‚è¨­å®š
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT USAGE ON SEQUENCES TO authenticated;

GRANT USAGE ON SEQUENCE public.sptce_plan_execution_settings_id_seq TO authenticated;
GRANT USAGE ON SEQUENCE public.sptce_plan_execution_simulation_results_id_seq TO authenticated;



```